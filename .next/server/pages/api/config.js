"use strict";(()=>{var e={};e.id=589,e.ids=[589],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7926:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,s){return s in r?r[s]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,s)):"function"==typeof r&&"default"===s?r:void 0}}})},1098:(e,r,s)=>{s.r(r),s.d(r,{config:()=>m,default:()=>p,routeModule:()=>b});var t={};s.r(t),s.d(t,{default:()=>d});var a=s(8056),n=s(9534),i=s(7926),o=s(2885),u=s(6221);let c=(0,o.createClient)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e,r){try{let s=await (0,u.WX)(e);if(!s)return r.status(401).json({success:!1,error:"Unauthorized"});switch(e.method){case"GET":return await l(e,r,s);case"POST":return await f(e,r,s);case"PUT":return await g(e,r,s);case"DELETE":return await _(e,r,s);default:return r.status(405).json({success:!1,error:"Method not allowed"})}}catch(e){console.error("Config API error:",e),r.status(500).json({success:!1,error:"Internal server error"})}}async function l(e,r,s){let{data:t,error:a}=await c.from("arbitrage_config").select("*").eq("user_id",s.userId).order("created_at",{ascending:!1});if(a)return r.status(500).json({success:!1,error:a.message});r.status(200).json({success:!0,data:t})}async function f(e,r,s){let{name:t,min_profit_basis_points:a,max_slippage_basis_points:n,max_gas_price_gwei:i,enabled_tokens:o,enabled_dexes:u,flash_loan_enabled:d,max_trade_amount_eth:l}=e.body;if(!t||!o||!u)return r.status(400).json({success:!1,error:"Name, enabled_tokens, and enabled_dexes are required"});if(a<1||a>1e3)return r.status(400).json({success:!1,error:"Min profit basis points must be between 1 and 1000"});let{data:f,error:g}=await c.from("arbitrage_config").insert({user_id:s.userId,name:t,min_profit_basis_points:a||50,max_slippage_basis_points:n||300,max_gas_price_gwei:i||50,enabled_tokens:o,enabled_dexes:u,flash_loan_enabled:!1!==d,max_trade_amount_eth:l||1,is_active:!0}).select().single();if(g)return r.status(500).json({success:!1,error:g.message});await c.rpc("log_system_event",{log_level:"info",component_name:"api",log_message:"Arbitrage configuration created",log_details:{configId:f.id,name:t},user_uuid:s.userId}),r.status(201).json({success:!0,data:f})}async function g(e,r,s){let{id:t}=e.query,a=e.body;if(!t)return r.status(400).json({success:!1,error:"Config ID is required"});let{data:n,error:i}=await c.from("arbitrage_config").select("user_id").eq("id",t).single();if(i||!n)return r.status(404).json({success:!1,error:"Configuration not found"});if(n.user_id!==s.userId&&"admin"!==s.role)return r.status(403).json({success:!1,error:"Access denied"});let{data:o,error:u}=await c.from("arbitrage_config").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(u)return r.status(500).json({success:!1,error:u.message});await c.rpc("log_system_event",{log_level:"info",component_name:"api",log_message:"Arbitrage configuration updated",log_details:{configId:t,changes:a},user_uuid:s.userId}),r.status(200).json({success:!0,data:o})}async function _(e,r,s){let{id:t}=e.query;if(!t)return r.status(400).json({success:!1,error:"Config ID is required"});let{data:a,error:n}=await c.from("arbitrage_config").select("user_id, name").eq("id",t).single();if(n||!a)return r.status(404).json({success:!1,error:"Configuration not found"});if(a.user_id!==s.userId&&"admin"!==s.role)return r.status(403).json({success:!1,error:"Access denied"});let{error:i}=await c.from("arbitrage_config").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",t);if(i)return r.status(500).json({success:!1,error:i.message});await c.rpc("log_system_event",{log_level:"info",component_name:"api",log_message:"Arbitrage configuration deleted",log_details:{configId:t,name:a.name},user_uuid:s.userId}),r.status(200).json({success:!0,data:{message:"Configuration deleted successfully"}})}let p=(0,i.l)(t,"default"),m=(0,i.l)(t,"config"),b=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/config",pathname:"/api/config",bundlePath:"",filename:""},userland:t})},6221:(e,r,s)=>{s.d(r,{WX:()=>o});var t=s(9344),a=s.n(t);require("bcryptjs");let n=process.env.JWT_SECRET,i=(process.env.JWT_EXPIRES_IN,process.env.JWT_ISSUER||"theatom-app");if(!n||n.includes("change-this")||n.length<16)throw Error("\uD83D\uDEA8 SECURITY ERROR: JWT_SECRET must be set to a secure value (16+ characters)");async function o(e){try{let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return null;let s=r.substring(7);if(!s)return null;let t=a().verify(s,n,{issuer:i,algorithms:["HS256"]});return{userId:t.userId,email:t.email,role:t.role}}catch(e){return console.error("Token verification error:",e),null}}},9534:(e,r)=>{var s;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},8056:(e,r,s)=>{e.exports=s(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var s=r(r.s=1098);module.exports=s})();