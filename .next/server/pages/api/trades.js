"use strict";(()=>{var e={};e.id=81,e.ids=[81],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7926:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},6507:(e,r,t)=>{t.r(r),t.d(r,{config:()=>p,default:()=>d,routeModule:()=>f});var s={};t.r(s),t.d(s,{default:()=>l});var n=t(8056),a=t(9534),o=t(7926),u=t(2885),i=t(6221);let c=(0,u.createClient)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function l(e,r){try{let t=await (0,i.WX)(e);if(!t)return r.status(401).json({success:!1,error:"Unauthorized"});if("GET"!==e.method)return r.status(405).json({success:!1,error:"Method not allowed"});let{page:s="1",limit:n="50",status:a,token_in:o,token_out:u,dex_path:l,start_date:d,end_date:p,sort_by:f="executed_at",sort_order:E="desc"}=e.query,P=parseInt(s),_=parseInt(n),h=(P-1)*_,A=c.from("arbitrage_trades").select("*",{count:"exact"}).eq("user_id",t.userId);a&&(A=A.eq("status",a)),o&&(A=A.eq("token_in",o)),u&&(A=A.eq("token_out",u)),l&&(A=A.ilike("dex_path",`%${l}%`)),d&&(A=A.gte("executed_at",d)),p&&(A=A.lte("executed_at",p)),A=(A=A.order(f,{ascending:"asc"===E})).range(h,h+_-1);let{data:g,error:m,count:v}=await A;if(m)return r.status(500).json({success:!1,error:m.message});let S=Math.ceil((v||0)/_);r.status(200).json({success:!0,data:g,pagination:{page:P,limit:_,total:v||0,totalPages:S}})}catch(e){console.error("Trades API error:",e),r.status(500).json({success:!1,error:"Internal server error"})}}let d=(0,o.l)(s,"default"),p=(0,o.l)(s,"config"),f=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/trades",pathname:"/api/trades",bundlePath:"",filename:""},userland:s})},6221:(e,r,t)=>{t.d(r,{WX:()=>u});var s=t(9344),n=t.n(s);require("bcryptjs");let a=process.env.JWT_SECRET,o=(process.env.JWT_EXPIRES_IN,process.env.JWT_ISSUER||"theatom-app");if(!a||a.includes("change-this")||a.length<16)throw Error("\uD83D\uDEA8 SECURITY ERROR: JWT_SECRET must be set to a secure value (16+ characters)");async function u(e){try{let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return null;let t=r.substring(7);if(!t)return null;let s=n().verify(t,a,{issuer:o,algorithms:["HS256"]});return{userId:s.userId,email:s.email,role:s.role}}catch(e){return console.error("Token verification error:",e),null}}},9534:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},8056:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=6507);module.exports=t})();