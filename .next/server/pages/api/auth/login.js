"use strict";(()=>{var e={};e.id=908,e.ids=[908],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7926:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,s){return s in r?r[s]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,s)):"function"==typeof r&&"default"===s?r:void 0}}})},1e3:(e,r,s)=>{s.r(r),s.d(r,{config:()=>f,default:()=>p,routeModule:()=>g});var t={};s.r(t),s.d(t,{default:()=>c});var o=s(8056),i=s(9534),a=s(7926),n=s(2885),u=s(9344),l=s.n(u);let d=(0,n.createClient)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function c(e,r){if("POST"!==e.method)return r.status(405).json({success:!1,error:"Method not allowed"});try{let{email:s,password:t}=e.body;if(!s||!t)return r.status(400).json({success:!1,error:"Email and password are required"});let{data:o,error:i}=await d.auth.signInWithPassword({email:s,password:t});if(i||!o.user)return r.status(401).json({success:!1,error:"Invalid credentials"});let{data:a,error:n}=await d.from("users").select("id, email, role, is_active").eq("id",o.user.id).single();if(n||!a)return r.status(500).json({success:!1,error:"Failed to fetch user profile"});if(!a.is_active)return r.status(403).json({success:!1,error:"Account is deactivated"});await d.from("users").update({last_login:new Date().toISOString()}).eq("id",o.user.id);let u=l().sign({userId:a.id,email:a.email,role:a.role},process.env.JWT_SECRET,{expiresIn:"24h"});await d.rpc("log_system_event",{log_level:"info",component_name:"auth",log_message:"User logged in successfully",log_details:{userId:a.id,email:a.email},user_uuid:a.id}),r.status(200).json({success:!0,token:u,user:{id:a.id,email:a.email,role:a.role}})}catch(e){console.error("Login error:",e),await d.rpc("log_system_event",{log_level:"error",component_name:"auth",log_message:"Login failed",log_details:{error:e.message}}),r.status(500).json({success:!1,error:"Internal server error"})}}let p=(0,a.l)(t,"default"),f=(0,a.l)(t,"config"),g=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:t})},9534:(e,r)=>{var s;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},8056:(e,r,s)=>{e.exports=s(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var s=r(r.s=1e3);module.exports=s})();