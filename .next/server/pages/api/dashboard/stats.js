"use strict";(()=>{var e={};e.id=106,e.ids=[106],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7926:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},1991:(e,r,t)=>{t.r(r),t.d(r,{config:()=>_,default:()=>l,routeModule:()=>p});var s={};t.r(s),t.d(s,{default:()=>d});var a=t(8056),u=t(9534),o=t(7926),n=t(2885),i=t(6221);let c=(0,n.createClient)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e,r){try{let t=await (0,i.WX)(e);if(!t)return r.status(401).json({success:!1,error:"Unauthorized"});if("GET"!==e.method)return r.status(405).json({success:!1,error:"Method not allowed"});let{days:s="30"}=e.query,a=parseInt(s),{data:u,error:o}=await c.rpc("get_user_stats",{user_uuid:t.userId});if(o)return r.status(500).json({success:!1,error:o.message});let{data:n,error:d}=await c.rpc("get_profit_by_token",{user_uuid:t.userId});if(d)return r.status(500).json({success:!1,error:d.message});let{data:l,error:_}=await c.rpc("get_profit_by_dex",{user_uuid:t.userId});if(_)return r.status(500).json({success:!1,error:_.message});let{data:p,error:f}=await c.rpc("get_daily_profit_summary",{user_uuid:t.userId,days_back:a});if(f)return r.status(500).json({success:!1,error:f.message});let{data:m,error:E}=await c.from("recent_activity").select("*").eq("user_id",t.userId).order("timestamp",{ascending:!1}).limit(20);if(E)return r.status(500).json({success:!1,error:E.message});r.status(200).json({success:!0,data:{overview:u[0]||{total_trades:0,successful_trades:0,total_profit:0,success_rate:0,avg_profit_per_trade:0,total_gas_used:0,avg_gas_per_trade:0},profit_by_token:n||[],profit_by_dex:l||[],daily_summary:p||[],recent_activity:m||[]}})}catch(e){console.error("Dashboard stats API error:",e),r.status(500).json({success:!1,error:"Internal server error"})}}let l=(0,o.l)(s,"default"),_=(0,o.l)(s,"config"),p=new a.PagesAPIRouteModule({definition:{kind:u.x.PAGES_API,page:"/api/dashboard/stats",pathname:"/api/dashboard/stats",bundlePath:"",filename:""},userland:s})},6221:(e,r,t)=>{t.d(r,{WX:()=>n});var s=t(9344),a=t.n(s);require("bcryptjs");let u=process.env.JWT_SECRET,o=(process.env.JWT_EXPIRES_IN,process.env.JWT_ISSUER||"theatom-app");if(!u||u.includes("change-this")||u.length<16)throw Error("\uD83D\uDEA8 SECURITY ERROR: JWT_SECRET must be set to a secure value (16+ characters)");async function n(e){try{let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return null;let t=r.substring(7);if(!t)return null;let s=a().verify(t,u,{issuer:o,algorithms:["HS256"]});return{userId:s.userId,email:s.email,role:s.role}}catch(e){return console.error("Token verification error:",e),null}}},9534:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},8056:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1991);module.exports=t})();